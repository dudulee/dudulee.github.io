<head>
<meta charset="UTF-8">
    <title>Linux iSCSI Initiator</title>
    <link href="../styles/main_styles.css" rel="stylesheet" type="text/css" media="all">
    <link href="../styles/blog.css" rel="stylesheet" type="text/css" media="all">
</head>
<body>
    <h1 class="center">Procédure d'installation d'un SAN ISCSI sur Debian</h1>
    <p class="center"><a href="../index.html" rel=prev>Main menu</a></p>
    <p class="center"><a href="../procedures.html" rel=prev>Return</a></p>

    <div id="holder">
        <div class="entry">
            <h2>1. Les Raids</h2>
            <br>
            <p>Nous avons fait les raids directement via l'utilitaire du BIOS, un raid 5 composé de 3 disques qui sont destiné au SAN et un raid 1 pour installer l'OS. </p>
            <br>
            <h2>2. Configuration de la carte Réseau du serveur Debian</h2>
            <br>
            <p>Avant de connecter le serveur sur le switch, nous avons définit une adresse ip statique pour le serveur en ajoutant dans le fichier /etc/network/interfaces ces lignes:</p>
            <p><code>
allow-hotplug eth1
iface eth1 inet static
address 192.168.1.252
netmask 255.255.255.0
network 192.168.1.0
            </code></p>
            <h2>3. Installation et configuration d'iscsi target sur Debian</h2>
            <p>On commence par installer les dépendances nécessaires pour l'installation d'iscsi:</p>
            <p><code>
apt-get install iscsitarget iscsitarget-dkms lvm2
                </code></p>
            <br>
            <p>On édite ensuite le fichier /etc/default/iscsitarget:</p>
            <p><code>
                nano /etc/default/iscsitarget
                </code></p>
            <p>et on met ISCSITARGERT_ENABLE à true:</p>
            <p><code>
                ISCSITARGET_ENABLE=true
                </code></p>
            <p>On passe maintenant à la création d'un volume avec une capacité de 20giga nommé LUN750 apppartenant au groupe GR-LUN</p>
            <p><code>
                lvcreate -L20G -n LUN750 GR-LUN
                </code></p>
            <p>On affiche ensuite le volume créer pour vérifier:</p>
            <p><code>
                lvs
                </code></p>
            <p><a href="../img/Iscsi-Linux1.PNG"><img src="../img/Iscsi-Linux1.PNG" alt="context-menu"/></a></p>
            <br>
            <p>Then we have to Open /etc/default/iscsitarget</p>
            <br>
            <p><a href="../img/Iscsi-Linux2.PNG"><img src="../img/Iscsi-Linux2.PNG" alt="context-menu"/></a></p>
            <br>
            <p>And set ISCSITARGET_ENABLE to true</p>
            <br>
            <p><a href="../img/Iscsi-Linuxtrue.PNG"><img src="../img/Iscsi-Linuxtrue.PNG" alt="context-menu"/></a></p>
            <br>
            <p>
              We can use unused logical volumes, image files, hard drives (e.g. /dev/sdb),
              hard drive partitions (e.g. /dev/sdb1) or RAID devices (e.g. /dev/md0) for the storage.
              In the following command, we put 20G in a volume
            </p>
            <br>
            <p><a href="../img/Iscsi-Linux3.PNG"><img src="../img/Iscsi-Linux3.PNG" alt="context-menu"/></a></p>
            <br>
            <p>
              Now that we've created a logical volume of 20GB named storage_lun1 in the volume group vg0,
              we will edit /etc/iet/ietd.conf
            </p>
            <br>
            <p><a href="../img/Iscsi-Linux4.PNG"><img src="../img/Iscsi-Linux4.PNG" alt="context-menu"/></a></p>
            <br>
            <p>
              and comment out everything in that file. At the end we add the following stanza: (insert ours)
            </p>
            <p>
                Now we tell the target that we want to allow connections to the device iqn.2001-04.com.example:storage.lun1
                from the IP address of our server. Thus the logical stockage device will comunicate will our server
            </p>
            <br>
            <p><a href="../img/Iscsi-Linux5.PNG"><img src="../img/Iscsi-Linux5.PNG" alt="context-menu"/></a></p>
            <br>
            <p>And start the target</p>
            <br>
            <p><a href="../img/Iscsi-Linux6.PNG"><img src="../img/Iscsi-Linux6.PNG" alt="context-menu"/></a></p>
            <br>
        </div>
    </div>
</body>
